<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Purchase Order — Sixtiq</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--red:#e60000;--maroon:#550000;--ink:#111;--line:#dcdcdc;--paper:#fff;--pad:14px;}
*{box-sizing:border-box}body{font-family:'Open Sans',sans-serif;margin:0;background:#f4f6f8;color:var(--ink);padding:18px;}
.container{max-width:900px;margin:0 auto;background:var(--paper);box-shadow:0 12px 40px rgba(16,24,40,0.08);border-radius:8px;overflow:hidden}
.header{display:flex;gap:12px;padding:18px;border-bottom:6px solid var(--maroon);align-items:flex-start}
.left-head{width:48%}
.logo-box{width:160px;height:72px;border:2px dashed #bbb;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;background:#fff;overflow:hidden}
.company-info{margin-top:8px}
.company-name{font-weight:800;font-size:16px}
.address{font-size:13px;color:#444;margin-top:6px;white-space:pre-line}
.right-head{width:52%;text-align:right;padding-right:8px}
.po-title{font-size:28px;font-weight:900;color:var(--red);letter-spacing:1px}
.meta-row{display:flex;justify-content:flex-end;gap:8px;margin-top:8px;flex-wrap:wrap;}
.meta-item{background:#fff;border:1px solid var(--line);padding:8px;border-radius:6px;min-width:110px}
.meta-item label{font-size:12px;color:#666;display:block;margin-bottom:4px}
.meta-item input,.meta-item select{width:100%;padding:6px;border:1px solid #ddd;border-radius:6px;font-size:14px}

/* Vendor/Ship boxes */
.blocks{display:flex;gap:12px;padding:18px;border-bottom:1px solid var(--line);flex-wrap:wrap}
.block{flex:1;min-width:260px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.block h4{margin:0 0 8px;background:var(--maroon);color:#fff;display:inline-block;padding:6px 10px;border-radius:4px;font-size:13px}

/* Table */
.table-wrap{padding:18px}
.po-table{width:100%;border-collapse:collapse;border:1px solid var(--line);background:#fff}
.po-table th{background:var(--maroon);color:#fff;padding:8px;text-align:left;font-size:13px;border-right:1px solid #fff}
.po-table td{padding:8px;border-bottom:1px solid var(--line);border-right:1px solid var(--line);font-size:13px}
.po-table th:last-child,.po-table td:last-child{border-right:none}
.controls{display:flex;justify-content:flex-end;padding:8px 18px;gap:8px}

/* bottom split: comments left, totals right */
.bottom-row{display:flex;gap:12px;padding:18px;flex-wrap:wrap}
.comments{flex:1;min-width:320px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.comments h4{margin:0 0 8px;background:#eee;padding:6px;border-radius:4px;font-size:13px}
.comments textarea{width:100%;min-height:110px;padding:8px;border-radius:6px;border:1px solid #ddd;font-size:14px}
.totals{width:320px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.totals .line{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee}
.totals .line input{width:110px;text-align:right;padding:6px;border-radius:6px;border:1px solid #ddd}
.totals .grand{background:var(--maroon);color:#fff;padding:10px;border-radius:6px;margin-top:8px;font-weight:800;display:flex;justify-content:space-between}

/* footer & preview */
.footer{padding:12px;text-align:center;color:var(--maroon);font-weight:700;border-top:1px dashed var(--line)}
.preview-wrap{padding:12px;display:flex;justify-content:flex-end}
.preview-btn{background:var(--red);color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:800}

/* modal */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;z-index:1200}
.modal{background:#fff;border-radius:8px;max-width:880px;width:96%;max-height:90vh;overflow:auto;box-shadow:0 10px 40px rgba(0,0,0,0.2)}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid var(--line)}
.modal-body{padding:12px}
.btn{padding:8px 12px;border-radius:6px;font-weight:700;cursor:pointer}
.btn-primary{background:var(--red);color:#fff;border:none}
.btn-secondary{background:#fff;border:1px solid #ddd}

/* send menu */
.send-menu{position:absolute;right:12px;top:40px;background:#fff;border:1px solid var(--line);border-radius:6px;display:none;flex-direction:column;z-index:1300;padding:6px;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
.send-menu div{padding:8px 12px;cursor:pointer}
.send-menu div:hover{background:#f6f6f6}

/* success */
.success{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:1400}
.success-card{background:#fff;padding:18px;border-radius:8px;text-align:center;min-width:260px}
.success-check{font-size:36px;color:var(--red);margin-bottom:8px}

/* responsive */
@media(max-width:760px){
  .header{flex-direction:column;align-items:center;text-align:center}
  .left-head,.right-head{width:100%}
  .blocks{flex-direction:column}
  .bottom-row{flex-direction:column}
  .totals{width:100%}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="left-head">
      <label class="logo-box" id="logoBox">Upload Logo</label>
      <div class="company-info">
        <div class="company-name" id="companyName" contenteditable="true">[Company Name]</div>
        <div class="address" id="companyAddress"></div>
      </div>
    </div>
    <div class="right-head">
      <div class="po-title">PURCHASE ORDER</div>
      <div class="meta-row">
        <div class="meta-item"><label>Date</label><input id="poDate" placeholder="dd/mm/yyyy"></div>
        <div class="meta-item"><label>PO #</label><input id="poNumber"></div>
        <div class="meta-item"><label>Currency</label><select id="currency"><option value="₦">₦ Naira</option><option value="$">$ Dollar</option><option value="€">€ Euro</option><option value="£">£ Pound</option><option value="¥">¥ Yen</option></select></div>
      </div>
    </div>
  </div>

  <div class="blocks">
    <div class="block">
      <h4>VENDOR</h4>
      <input id="vendorName" placeholder="[Company Name]" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px">
      <textarea id="vendorAddress" placeholder="[Street Address]" style="width:100%;min-height:60px;border:1px solid #ddd;border-radius:6px;padding:8px;margin-top:8px"></textarea>
      <input id="vendorPhone" placeholder="Phone" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:8px">
    </div>
    <div class="block">
      <h4>SHIP TO</h4>
      <input id="shipName" placeholder="[Company Name]" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px">
      <textarea id="shipAddress" placeholder="[Street Address]" style="width:100%;min-height:60px;border:1px solid #ddd;border-radius:6px;padding:8px;margin-top:8px"></textarea>
      <input id="shipPhone" placeholder="Phone" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:8px">
    </div>
  </div>

  <div class="table-wrap">
    <table class="po-table" id="itemsTable">
      <thead>
        <tr><th>ITEM #</th><th>DESCRIPTION</th><th>QTY</th><th>UNIT PRICE</th><th style="text-align:right">TOTAL</th></tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>
    <div class="controls"><button class="btn btn-primary" id="addRow">+ Add Item</button></div>
  </div>

  <div class="bottom-row">
    <div class="comments">
      <h4>Comments or Special Instructions</h4>
      <textarea id="comments" placeholder="Comments or special instructions..."></textarea>
    </div>
    <div class="totals">
      <div class="line"><div>SUBTOTAL</div><div id="subTotal">₦0.00</div></div>
      <div class="line"><div>TAX</div><div><input id="taxInput" type="number" value="0"></div></div>
      <div class="line"><div>SHIPPING</div><div><input id="shipInput" type="number" value="0"></div></div>
      <div class="line"><div>OTHER</div><div><input id="otherInput" type="number" value="0"></div></div>
      <div class="grand"><div>TOTAL</div><div id="grandTotal">₦0.00</div></div>
    </div>
  </div>

  <div class="footer">Powered by Sixtiq</div>
  <div class="preview-wrap"><button class="preview-btn" id="previewBtn">Preview</button></div>
</div>

<!-- Modals -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-header">
      <div style="font-weight:800">Purchase Order Preview</div>
      <div style="position:relative">
        <button class="btn btn-primary" id="sendBtn">Send ▾</button>
        <div class="send-menu" id="sendMenu">
          <div data-action="whatsapp">Send via WhatsApp</div>
          <div data-action="email">Send via Email</div>
          <div data-action="x">Share on X</div>
          <div data-action="instagram">Share on Instagram</div>
          <div data-action="download">Download PDF</div>
        </div>
        <button class="btn btn-secondary" id="backBtn">Back</button>
      </div>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<div class="success" id="success">
  <div class="success-card">
    <div class="success-check">✔</div>
    <div id="successText" style="font-weight:800;margin-top:6px">Purchase Order Sent!</div>
  </div>
</div>

<input id="logoInput" type="file" accept="image/*" style="display:none">


<script>
const $ = id => document.getElementById(id);
let logoData=null;

function init(){
  $("poDate").value=fmtDate(new Date());
  $("poNumber").value=nextPONumber();
  addItem(); addItem();
  bind(); recalc();
}
function fmtDate(d){return String(d.getDate()).padStart(2,"0")+"/"+String(d.getMonth()+1).padStart(2,"0")+"/"+d.getFullYear();}
function poCounterKey(){return "sixtiq_po_"+new Date().getFullYear();}
function nextPONumber(){const k=poCounterKey();let n=parseInt(localStorage.getItem(k)||"0",10)+1;localStorage.setItem(k,n);return "PO-"+new Date().getFullYear()+"-"+String(n).padStart(4,"0");}

function addItem(){const tr=document.createElement("tr");tr.className="item-row";tr.innerHTML=`<td><input class="idx"></td><td><input class="desc"></td><td><input class="qty" type="number" value="1"></td><td><input class="price" type="number" value="0"></td><td><span class="amount">0.00</span><button class="del">🗑️</button></td>`;$("itemsBody").appendChild(tr);tr.querySelectorAll("input").forEach(i=>i.addEventListener("input",()=>updateRow(tr)));tr.querySelector(".del").addEventListener("click",()=>{tr.r...
function updateRow(row){const q=parseFloat(row.querySelector(".qty").value)||0;const p=parseFloat(row.querySelector(".price").value)||0;const symbol=$("currency").value||"₦";row.querySelector(".amount").textContent=symbol+(q*p).toFixed(2);recalc();}

function recalc(){
  let sum = 0;
  document.querySelectorAll('.item-row .amount').forEach(el => {
    const v = parseFloat(el.textContent.replace(/[^0-9.-]+/g,'')) || 0;
    sum += v;
  });
  const taxPercent = parseFloat(taxInput.value) || 0;
  const taxAmount = (sum * taxPercent) / 100;
  const s = parseFloat(shipInput.value) || 0;
  const o = parseFloat(otherInput.value) || 0;
  const g = sum + taxAmount + s + o;
  const symbol = $("currency").value || '₦';
  subTotal.textContent = symbol + sum.toFixed(2);
  grandTotal.textContent = symbol + g.toFixed(2);
}

function buildPreviewHTML(){
  const symbol = $("currency").value||"₦";
  let itemsHTML="";
  document.querySelectorAll("#itemsBody tr").forEach((tr,i)=>{
    const idx=tr.querySelector(".idx").value;
    const desc=tr.querySelector(".desc").value;
    const qty=tr.querySelector(".qty").value;
    const price=tr.querySelector(".price").value;
    const amount=tr.querySelector(".amount").textContent;
    itemsHTML+=`<tr><td>${idx}</td><td>${desc}</td><td>${qty}</td><td>${symbol}${parseFloat(price||0).toFixed(2)}</td><td style="text-align:right">${amount}</td></tr>`;
  });

  return `
  <div style="font-family:Open Sans;padding:20px;max-width:800px;margin:auto;color:#111">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;border-bottom:4px solid #550000;padding-bottom:10px;margin-bottom:10px">
      <div>
        ${logoData?`<img src="${logoData}" style="max-height:60px">`:"<div style='border:1px dashed #aaa;width:120px;height:60px;display:flex;align-items:center;justify-content:center'>Logo</div>"}
        <div style="font-weight:800;font-size:16px;margin-top:6px">${$("companyName").textContent}</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:24px;font-weight:900;color:#e60000">PURCHASE ORDER</div>
        <div>Date: ${$("poDate").value}</div>
        <div>PO #: ${$("poNumber").value}</div>
        <div>Currency: ${symbol}</div>
      </div>
    </div>
    <div style="display:flex;gap:20px;margin-bottom:12px">
      <div style="flex:1;border:1px solid #ddd;padding:8px">
        <div style="background:#550000;color:#fff;padding:4px 8px;font-size:12px">VENDOR</div>
        <div>${$("vendorName").value}</div>
        <div>${$("vendorAddress").value}</div>
        <div>${$("vendorPhone").value}</div>
      </div>
      <div style="flex:1;border:1px solid #ddd;padding:8px">
        <div style="background:#550000;color:#fff;padding:4px 8px;font-size:12px">SHIP TO</div>
        <div>${$("shipName").value}</div>
        <div>${$("shipAddress").value}</div>
        <div>${$("shipPhone").value}</div>
      </div>
    </div>
    <table style="width:100%;border-collapse:collapse;margin-bottom:12px">
      <thead><tr style="background:#550000;color:#fff"><th>ITEM #</th><th>DESCRIPTION</th><th>QTY</th><th>UNIT PRICE</th><th style="text-align:right">TOTAL</th></tr></thead>
      <tbody>${itemsHTML}</tbody>
    </table>
    <div style="display:flex;gap:20px">
      <div style="flex:1;border:1px solid #ddd;padding:8px">
        <div style="font-weight:700;margin-bottom:6px">Comments</div>
        <div>${$("comments").value}</div>
      </div>
      <div style="width:220px;border:1px solid #ddd;padding:8px">
        <div>Subtotal: ${$("subTotal").textContent}</div>
        <div>Tax (${taxInput.value||0}%): ${symbol}${((parseFloat(taxInput.value)||0)* (parseFloat($("subTotal").textContent.replace(/[^0-9.-]/g,''))||0)/100).toFixed(2)}</div>
        <div>Shipping: ${symbol}${(parseFloat(shipInput.value)||0).toFixed(2)}</div>
        <div>Other: ${symbol}${(parseFloat(otherInput.value)||0).toFixed(2)}</div>
        <div style="background:#550000;color:#fff;font-weight:800;padding:6px;margin-top:6px">Grand Total: ${$("grandTotal").textContent}</div>
      </div>
    </div>
    <div style="margin-top:20px;text-align:center;font-weight:700;color:#550000">Powered by Sixtiq</div>
  </div>`;
}

function openPreview(){$("modalBody").innerHTML=buildPreviewHTML();$("overlay").style.display="flex";}

async function onSendOption(e){const act=e.target.dataset.action;$("sendMenu").style.display="none";if(act==="download"){await exportPDF();showSuccess("Downloaded!");}else{showSuccess("Sent!");}resetForm();}

async function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({unit:'pt', format:'a4'});
  const pageWidth = pdf.internal.pageSize.getWidth();
  const margin = 40;
  const usableWidth = pageWidth - margin*2;
  const html = buildPreviewHTML();
  const wrap = document.createElement("div");
  wrap.style.width = usableWidth + "px";
  wrap.innerHTML = html;
  document.body.appendChild(wrap);
  const canvas = await html2canvas(wrap,{scale:2,useCORS:true,backgroundColor:"#ffffff"});
  const img = canvas.toDataURL("image/png");
  const pdfHeight = (canvas.height * usableWidth) / canvas.width;
  pdf.addImage(img, "PNG", margin, margin, usableWidth, pdfHeight);
  pdf.save(($("poNumber").value || "purchase-order") + ".pdf");
  document.body.removeChild(wrap);
}

function showSuccess(msg){$("successText").textContent=msg;$("success").style.display="flex";setTimeout(()=>{$("success").style.display="none";},1500);}
function resetForm(){document.querySelectorAll("input,textarea").forEach(i=>i.value="");$("itemsBody").innerHTML="";addItem();addItem();$("poNumber").value=nextPONumber();subTotal.textContent="₦0.00";grandTotal.textContent="₦0.00";$("overlay").style.display="none";}

function bind(){$("addRow").addEventListener("click",addItem);$("previewBtn").addEventListener("click",openPreview);$("backBtn").addEventListener("click",()=>$("overlay").style.display="none");$("sendBtn").addEventListener("click",()=>$("sendMenu").style.display="flex");document.querySelectorAll(".send-menu div").forEach(d=>d.addEventListener("click",onSendOption));[$("taxInput"),$("shipInput"),$("otherInput"),$("currency")].forEach(el=>el.addEventListener("input",recalc));}

init();
</script>

</body>
</html>